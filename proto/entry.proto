syntax = "proto3";
package google.gink;
import "value.proto";
import "muid.proto";
import "behavior.proto";
import "key.proto";

message Entry {
    Behavior behavior = 1; // should match the behavior of container
    Muid container = 2;

    oneof link {
        Key key = 3;        // KEY_SET, DIRECTORY
        Muid describes = 4; // RELATION, MEMBERSHIP, PROPERTY
        Span span = 5;      // FILE
    }

    oneof contains {
        // some of these only apply to certain container types:
        bool deletion = 6; // KEY_SET, DIRECTORY, MEMBERSHIP, PROPERTY
        Value value = 7;   // BOX, DIRECTORY, SEQUENCE, PROPERTY
        bytes octects = 8; // FILE, PACKET_SEQ
        Row row = 9;       // BASIC_TABLE, KEYED_TABLE
        double delta = 10; // SUMMATION
        Muid pointee = 11; // BOX, DIRECTORY, SEQUENCE, RELATION 
    }

    uint64 expiry = 12; // timestamp of expiration in microseconds since epoch, or 0 for none
    uint64 position = 13; // timestamp of initial position in ordered container, or 0 for entry ts

    message Span {
        // defines where to put octects in the FILE, may be omitted to place all at start
        uint64 from=1;
        uint64 ends=2;
    }
    
    message Row {
        repeated Value values = 1;
        bytes bytes_mask = 2; // optional when all columns have values
    }
}
